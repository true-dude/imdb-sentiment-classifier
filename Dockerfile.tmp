FROM python:3.10-slim

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV PATH="/root/.local/bin:${PATH}"

RUN apt-get update && apt-get install -y git curl && rm -rf /var/lib/apt/lists/*
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

# Кладём проект целиком (включая uv.lock)
COPY . .

# Экспорт зависимостей из uv.lock и установка системно
RUN uv export --locked --no-dev --format requirements-txt > /tmp/requirements.lock \
    && uv pip install --system -r /tmp/requirements.lock \
    && rm /tmp/requirements.lock

CMD ["python", "train_cnn.py"]
